---
  - name: Allow forward between ironic and host network 
    hosts: localhost
    user: root
    vars:
      iptable_rules:
        - name: virbr0 
          route: 172.30.0.0/22
          comment: "Allow traffic from host network to ironic"
        - name: virbr0_ironic
          route: 192.168.122.0/24
          comment: "Allow traffic from ironic to host"

    tasks:
      - name: Add OUT interface iptable rules for ironic <> host
        iptables:
          chain: FORWARD
          out_interface: "{{item.name}}"
          destination: "{{item.route}}"
          jump: ACCEPT
          commentription: "{{item.comment}}"
        with_items: "{{iptable_rules}}"

      - name: Add IN interface iptable rules for ironic <> host
        iptables:
          chain: FORWARD
          in_interface: "{{item.name}}"
          source: "{{item.route}}"
          jump: ACCEPT
          commentription: "{{item.comment}}"
        with_items: "{{iptable_rules}}"
